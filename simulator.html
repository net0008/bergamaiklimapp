<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bergama & TR 2050: Ä°klim Karar MasasÄ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --dark: #2c3e50; --temp-red: #e74c3c; --rain-blue: #3498db; --btn: #2980b9; --green: #27ae60; }
        
        body { 
            font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; transition: 0.5s; background-size: cover; background-attachment: fixed; min-height: 100vh;
        }
        
        /* MOD Ã–ZELLÄ°KLERÄ° */
        /* YetiÅŸkin modunda da arka plan resmi aktif edildi, sadece renk filtresi daha ÅŸeffaf olacak */
        body.adult-mode { background-image: url('imagery/bergama-bg.jpg'); color: var(--dark); }
        body.child-mode { background-image: url('imagery/bergama-bg.jpg'); color: #fff; }

        /* SararÄ±p YeÅŸillenme Efektinin OlduÄŸu Katman */
        #bg-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
            background-color: rgba(220, 100, 0, 0.4); transition: background-color 1.5s ease; pointer-events: none;
        }

        .main-wrapper {
            position: relative; z-index: 1; border-radius: 25px; padding: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); max-width: 1100px; margin: auto; transition: 0.5s;
        }
        /* YetiÅŸkin modunda panelin iÃ§i okunabilirlik iÃ§in beyaz/ÅŸeffaf kalÄ±r */
        body.adult-mode .main-wrapper { background: rgba(255, 255, 255, 0.92); }
        body.child-mode .main-wrapper { background: rgba(0, 0, 0, 0.8); border: 2px solid #55FF55; }

        .container { display: grid; grid-template-columns: 1fr 1.5fr; gap: 30px; }
        
        .nav-bar { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; grid-column: span 2;}
        .nav-btn { padding: 12px 25px; background: var(--btn); color: white; text-decoration: none; border-radius: 50px; font-weight: bold; border:none; cursor:pointer; transition: 0.3s; display:inline-block; }
        
        .locked { background: #7f8c8d !important; cursor: not-allowed; opacity: 0.6; }

        #mission-status { 
            margin-bottom: 25px; padding: 15px; border-radius: 12px; text-align: left; font-size: 0.95em; 
            line-height: 1.5; border-left: 8px solid var(--temp-red); transition: 0.3s;
        }
        body.adult-mode #mission-status { background: white; color: var(--dark); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        body.child-mode #mission-status { background: #222; color: #55FF55; border-color: var(--temp-red); }

        .slider-group { margin-bottom: 20px; padding: 15px; border-radius: 15px; transition: 0.3s; }
        body.adult-mode .slider-group { background: rgba(255, 255, 255, 0.9); box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #eee; }
        body.child-mode .slider-group { background: #222; border: 1px solid #444; }

        .slider { width: 100%; cursor: pointer; -webkit-appearance: none; appearance: none; height: 10px; background: #dfe6e9; border-radius: 5px; outline: none;}
        .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 25px; height: 25px; background: var(--btn); border-radius: 50%; border: 3px solid white; }

        .slider-desc { margin: 8px 0 0; font-size: 0.8em; font-weight: normal; transition: 0.3s;}
        body.adult-mode .slider-desc { color: #7f8c8d; }
        body.child-mode .slider-desc { color: #aaa; }

        .output-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .stat-card { padding: 15px; border-radius: 15px; text-align: center; font-weight: bold; transition: 0.3s;}
        body.adult-mode .stat-card { background: rgba(255,255,255,0.9); box-shadow: 0 4px 10px rgba(0,0,0,0.1); color: var(--dark);}
        body.child-mode .stat-card { background: #333; color: white; border: 1px solid #555;}
        
        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; backdrop-filter: blur(5px); }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 90%; color: black; }

    </style>
</head>
<body id="mainBody">

<div id="bg-overlay"></div>

<div class="main-wrapper">
    
    <div style="text-align: center; margin-bottom: 20px;">
        <h1 id="modeTitle" style="margin-top:0;">Bergama 2050: Karar MasasÄ±</h1>
        <div id="top-slogan" style="font-style:italic; font-weight:bold; font-size: 1.1em;"></div>
    </div>

    <div class="nav-bar">
        <a href="secim.html" class="nav-btn" style="background:var(--dark)">ğŸ”™ Mod DeÄŸiÅŸtir</a>
        <button onclick="toggleModal()" class="nav-btn" style="background:#f39c12">â„¹ï¸ NasÄ±l KullanÄ±lÄ±r?</button>
    </div>

    <div class="container">
        <div class="controls">
            <h3 style="margin-top:0;" id="panelTitle">ğŸ›‘ Gelecek Neslin Kaderini Belirle</h3>
            
            <div id="mission-status">LÃ¼tfen sÃ¼rgÃ¼leri hareket ettirerek kararlarÄ±nÄ±zÄ± verin...</div>
            
            <div class="slider-group">
                <label style="font-weight:bold;">âš¡ Temiz Enerji: <span id="v1">20</span>%</label>
                <input type="range" min="0" max="100" value="20" class="slider" id="s1">
                <p class="slider-desc">Fosil yakÄ±tlarÄ± bÄ±rakÄ±p gÃ¼neÅŸ ve rÃ¼zgara geÃ§iÅŸ oranÄ±mÄ±z.</p>
                <p id="eFeedback" style="margin: 8px 0 0; font-size: 0.85em; font-weight: bold; min-height: 15px;"></p>
            </div>
            
            <div class="slider-group">
                <label style="font-weight:bold;">ğŸŒ³ Dikilecek AÄŸaÃ§: <span id="v2">100.000</span> Adet</label>
                <input type="range" min="0" max="1000000" value="100000" step="10000" class="slider" id="s2">
                <p class="slider-desc">Bergama ve Kozak YaylasÄ±'na kazandÄ±rÄ±lacak yeni ormanlar.</p>
                <p id="tFeedback" style="margin: 8px 0 0; font-size: 0.85em; font-weight: bold; min-height: 15px;"></p>
            </div>
            
            <div class="slider-group">
                <label style="font-weight:bold;">ğŸšœ AkÄ±llÄ± TarÄ±m & Su: <span id="v3">30</span>%</label>
                <input type="range" min="0" max="100" value="30" class="slider" id="s3">
                <p class="slider-desc">Damla sulama teknolojisi ile su tasarrufu oranÄ±mÄ±z.</p>
                <p id="wFeedback" style="margin: 8px 0 0; font-size: 0.85em; font-weight: bold; min-height: 15px;"></p>
            </div>

            <div style="text-align:center; margin-top:20px;">
                <a href="ayak-izi.html" id="karne-btn" class="nav-btn locked">ğŸ”’ Ã–nce GÃ¶revi BaÅŸar</a>
            </div>
        </div>

        <div class="results">
            <div style="background:white; border-radius:15px; padding:10px;"><canvas id="simChart" style="height:280px;"></canvas></div>
            
            <div class="output-grid">
                <div class="stat-card" style="border-bottom:5px solid var(--temp-red);">
                    <span style="font-size:0.85em; display:block; margin-bottom:5px;">Bergama SÄ±caklÄ±k</span>
                    <div id="bt" style="font-size:1.4em;">23.1Â°C</div>
                </div>
                <div class="stat-card" style="border-bottom:5px solid var(--rain-blue);">
                    <span style="font-size:0.85em; display:block; margin-bottom:5px;">Bergama YaÄŸÄ±ÅŸ</span>
                    <div id="br" style="font-size:1.4em;">340 mm</div>
                </div>
                <div class="stat-card" style="border-bottom:5px solid var(--temp-red);">
                    <span style="font-size:0.85em; display:block; margin-bottom:5px;">TÃ¼rkiye SÄ±caklÄ±k</span>
                    <div id="trt" style="font-size:1.4em;">16.8Â°C</div>
                </div>
                <div class="stat-card" style="border-bottom:5px solid var(--rain-blue);">
                    <span style="font-size:0.85em; display:block; margin-bottom:5px;">TÃ¼rkiye YaÄŸÄ±ÅŸ</span>
                    <div id="trr" style="font-size:1.4em;">475 mm</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="helpModal" class="modal-overlay">
    <div class="modal-content">
        <h2 id="modalTitle" style="margin-top:0;">ğŸ® NasÄ±l KullanÄ±lÄ±r?</h2>
        <hr>
        <div id="modalBody" style="text-align: left; padding: 10px; line-height: 1.6; font-size: 1.1em;"></div>
        <button onclick="toggleModal()" class="nav-btn" style="width:100%; margin-top:15px; background:var(--green); font-size:1.1em;">AnladÄ±m!</button>
    </div>
</div>

<script>
    let simChart;
    const overlay = document.getElementById('bg-overlay');
    const mode = localStorage.getItem('user_mode') || 'child';
    
    document.body.className = mode + '-mode';
    
    // Modlara GÃ¶re Metinlerin AyarlanmasÄ±
    if (mode === 'adult') {
        document.getElementById('modeTitle').innerText = 'STRATEJÄ° MODU';
        document.getElementById('top-slogan').innerText = "Ã‡evre iÃ§in fedakarlÄ±k yapmazsanÄ±z, Ã§ocuklarÄ±nÄ±z iÃ§in fedakarlÄ±k yapmaya gerek yok.";
        document.getElementById('top-slogan').style.color = "var(--temp-red)";
        document.getElementById('panelTitle').innerText = "ğŸ“Š Stratejik Karar Paneli";
        document.getElementById('modalTitle').innerText = "ğŸ“Š Strateji Modu Nedir?";
        document.getElementById('modalBody').innerHTML = "<p>â€¢ <b>Karar Al:</b> SÃ¼rgÃ¼lerle 2050 projeksiyonunu belirleyin.</p><p>â€¢ <b>Etkiyi GÃ¶r:</b> YanlÄ±ÅŸ kararlarÄ±n yaÅŸamsal ve ekonomik maliyetini okuyun. Arka planÄ±n nasÄ±l Ã§Ã¶lleÅŸtiÄŸini izleyin.</p><p>â€¢ <b>Hedef:</b> SÄ±caklÄ±ÄŸÄ± dÃ¼ÅŸÃ¼rÃ¼p yaÄŸÄ±ÅŸÄ± artÄ±rarak Ã§ocuklarÄ±nÄ±za yeÅŸil bir miras bÄ±rakÄ±n.</p>";
    } else {
        document.getElementById('modeTitle').innerText = 'KAHRAMAN MODU';
        document.getElementById('top-slogan').innerText = "DÄ±ÅŸarÄ±ya gaz maskesi olmadan Ã§Ä±kmak iÃ§in geleceÄŸine sahip Ã§Ä±k!";
        document.getElementById('top-slogan').style.color = "#55FF55";
        document.getElementById('panelTitle').innerText = "ğŸ›‘ GeleceÄŸi Kurtar";
        document.getElementById('modalTitle').innerText = "ğŸ® GÃ¶revin: DÃ¼nyayÄ± Kurtar!";
        document.getElementById('modalBody').innerHTML = "<p>â€¢ <b>Karar Al:</b> SÃ¼rgÃ¼lerle doÄŸa dostu kararlar ver.</p><p>â€¢ <b>Etkiyi GÃ¶r:</b> SÄ±caklÄ±ÄŸÄ± dÃ¼ÅŸÃ¼rÃ¼p yaÄŸÄ±ÅŸÄ± artÄ±rmaya Ã§alÄ±ÅŸ.</p><p>â€¢ <b>Hedef:</b> 2050'de Bergama'yÄ± 22.2Â°C'nin altÄ±na indirip gaz maskelerinden kurtul!</p>";
    }

    function toggleModal() {
        const m = document.getElementById('helpModal');
        m.style.display = (m.style.display === 'block') ? 'none' : 'block';
    }

    function update() {
        const energy = parseInt(document.getElementById('s1').value);
        const trees = parseInt(document.getElementById('s2').value);
        const water = parseInt(document.getElementById('s3').value);

        // Bilimsel Hesaplama
        let bt = 23.1 - (energy * 0.025) - (trees * 0.00000035);
        let trt = 16.8 - (energy * 0.015) - (trees * 0.0000001);
        let br = 340 + (water * 2.2) + (trees * 0.00003);
        let trr = 475 + (water * 1.5) + (trees * 0.000015);

        // ArayÃ¼z DeÄŸerlerini GÃ¼ncelle
        document.getElementById('v1').innerText = energy;
        document.getElementById('v2').innerText = trees.toLocaleString('tr-TR');
        document.getElementById('v3').innerText = water;
        document.getElementById('bt').innerText = bt.toFixed(1) + "Â°C";
        document.getElementById('br').innerText = Math.round(br) + " mm";
        document.getElementById('trt').innerText = trt.toFixed(1) + "Â°C";
        document.getElementById('trr').innerText = Math.round(trr) + " mm";

        // --- SÃœRGÃœ ANLIK GERÄ° BÄ°LDÄ°RÄ°MLERÄ° ---
        const ef = document.getElementById('eFeedback');
        const tf = document.getElementById('tFeedback');
        const wf = document.getElementById('wFeedback');

        if(mode === 'adult') {
            ef.innerText = energy > 50 ? "âœ… Temiz hava yatÄ±rÄ±mÄ± baÅŸarÄ±lÄ±." : "âŒ UyarÄ±: Fosil yakÄ±t saÄŸlÄ±k maliyetlerini artÄ±rÄ±yor.";
            ef.style.color = energy > 50 ? "var(--green)" : "var(--temp-red)";
            
            tf.innerText = trees > 500000 ? "âœ… Yeni ormanlar Ä±sÄ± adalarÄ±nÄ± kÄ±rÄ±yor." : "âŒ UyarÄ±: Ã‡Ã¶lleÅŸme tehlikesi sÄ±nÄ±rÄ±nda.";
            tf.style.color = trees > 500000 ? "var(--green)" : "var(--temp-red)";
            
            wf.innerText = water > 50 ? "âœ… TarÄ±msal sÃ¼rdÃ¼rÃ¼lebilirlik saÄŸlandÄ±." : "âŒ UyarÄ±: YeraltÄ± sularÄ± tÃ¼keniyor.";
            wf.style.color = water > 50 ? "var(--green)" : "var(--temp-red)";
        } else {
            ef.innerText = energy > 50 ? "ğŸŒŸ Harika! GÃ¶kyÃ¼zÃ¼ temizleniyor." : "âš ï¸ Gaz bulutlarÄ± artÄ±yor!";
            ef.style.color = energy > 50 ? "#55FF55" : "#ff5555";
            
            tf.innerText = trees > 500000 ? "ğŸŒŸ Ormanlar bÃ¼yÃ¼yor, gÃ¶lge Ã§oÄŸalÄ±yor." : "âš ï¸ Her yer betonlaÅŸÄ±yor!";
            tf.style.color = trees > 500000 ? "#55FF55" : "#ff5555";
            
            wf.innerText = water > 50 ? "ğŸŒŸ GÃ¶ller doluyor, yaÅŸam canlanÄ±yor." : "âš ï¸ Sular Ã§ekiliyor, kuraklÄ±k kapÄ±da!";
            wf.style.color = water > 50 ? "#55FF55" : "#ff5555";
        }

        // --- ANA MESAJ VE KÄ°LÄ°T SÄ°STEMÄ° ---
        const msgBox = document.getElementById('mission-status');
        const btn = document.getElementById('karne-btn');

        if (mode === 'adult') {
            msgBox.innerHTML = bt > 22.2 
                ? "<b>Analiz:</b> âŒ Bu konfor tercihi, 2050'de Ã§ocuÄŸunuzun soluduÄŸu havadan Ã§alÄ±yor! SÄ±caklÄ±k hala Ã§ok yÃ¼ksek." 
                : "<b>Analiz:</b> âœ… Tebrikler! BugÃ¼nÃ¼n fedakarlÄ±ÄŸÄ±, Ã§ocuÄŸunuzun 2050'deki huzuru olacak.";
        } else {
            msgBox.innerHTML = bt > 22.2 
                ? "<b>Durum:</b> âš ï¸ Eyvah! Bu gidiÅŸle 2050'de evden Ã§Ä±karken gaz maskeni unutmamalÄ±sÄ±n!" 
                : "<b>Durum:</b> ğŸ›¡ï¸ Harika! GeleceÄŸini maskelerden kurtardÄ±n Kahraman!";
        }

        if (bt <= 22.2) {
            btn.className = "nav-btn"; btn.style.background = "var(--green)"; btn.innerText = "â¡ï¸ KiÅŸisel Teste GeÃ§";
            msgBox.style.borderColor = "var(--green)";
        } else {
            btn.className = "nav-btn locked"; btn.innerText = "ğŸ”’ GeleceÄŸi Kurtarmadan GeÃ§emezsin";
            msgBox.style.borderColor = "var(--temp-red)";
        }

        // --- 4 VERÄ°LÄ° GRAFÄ°K GÃœNCELLEME ---
        const chartData = [bt.toFixed(1), trt.toFixed(1), (br/20).toFixed(1), (trr/20).toFixed(1)];
        const realData = [bt.toFixed(1) + "Â°C", trt.toFixed(1) + "Â°C", Math.round(br) + " mm", Math.round(trr) + " mm"];

        if(!simChart) {
            const ctx = document.getElementById('simChart').getContext('2d');
            simChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Bergama SÄ±caklÄ±k', 'TÃ¼rkiye SÄ±caklÄ±k', 'Bergama YaÄŸÄ±ÅŸ', 'TÃ¼rkiye YaÄŸÄ±ÅŸ'],
                    datasets: [{ 
                        data: chartData, 
                        backgroundColor: ['#e74c3c','#ff7675','#3498db','#74b9ff'],
                        borderRadius: 8
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: {display: false},
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return realData[context.dataIndex];
                                }
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 35, display: false }
                    }
                }
            });
        } else { 
            simChart.data.datasets[0].data = chartData; 
            simChart.options.plugins.tooltip.callbacks.label = function(context) { return realData[context.dataIndex]; };
            simChart.update('none'); 
        }

        // --- ORTAK ARKAPLAN EFEKTÄ° (SararÄ±p YeÅŸillenme) ---
        // ArtÄ±k hem Ã§ocuk hem de yetiÅŸkin modunda arka plan rengi sÃ¼rgÃ¼lere gÃ¶re deÄŸiÅŸiyor.
        // Puan 0'a yakÄ±nken kÄ±rmÄ±zÄ±/turuncu (Ã§Ã¶lleÅŸme), 1'e yakÄ±nken yeÅŸil (canlanma) olur.
        let score = (energy/100 + water/100 + trees/1000000) / 3;
        
        // YetiÅŸkin modunda beyaz kutunun arkasÄ±nda daha hafif bir etki olmasÄ± iÃ§in opacity ayarÄ± yapÄ±ldÄ±.
        let opacity = mode === 'adult' ? 0.35 : 0.45; 
        
        overlay.style.backgroundColor = `hsla(${20 + (score * 100)}, 70%, 45%, ${opacity})`;

        // Verileri Sakla
        localStorage.setItem('sim_energy', energy);
        localStorage.setItem('sim_trees', trees);
        localStorage.setItem('sim_water', water);
        localStorage.setItem('sim_temp', bt.toFixed(1));
    }

    // SÃ¼rgÃ¼ler hareket ettikÃ§e update fonksiyonunu Ã§alÄ±ÅŸtÄ±r
    ['s1', 's2', 's3'].forEach(id => document.getElementById(id).oninput = update);
    window.onload = update;
</script>
</body>
</html>